<!DOCTYPE html>
<html>
 <head> 
  <meta charset="utf-8" /> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge" /> 
  <title>AdminLTE 2 | Dashboard</title> 
  <!-- Tell the browser to be responsive to screen width --> 
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" /> 
  <!-- Bootstrap 3.3.7 --> 
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" /> 
  <!-- Font Awesome --> 
  <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css" /> 
  <!-- Ionicons --> 
  <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css" /> 
  <!-- Theme style --> 
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css" /> 
  <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. --> 
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css" /> 
  <!-- Morris chart --> 
  <link rel="stylesheet" href="bower_components/morris.js/morris.css" /> 
  <!-- jvectormap --> 
  <link rel="stylesheet" href="bower_components/jvectormap/jquery-jvectormap.css" /> 
  <!-- Date Picker --> 
  <link rel="stylesheet" href="bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" /> 
  <!-- Daterange picker --> 
  <link rel="stylesheet" href="bower_components/bootstrap-daterangepicker/daterangepicker.css" /> 
  <!-- bootstrap wysihtml5 - text editor --> 
  <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" /> 
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries --> 
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// --> 
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]--> 
  <!-- Google Font --> 
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic" /> 
 </head> 
 <body class="hold-transition skin-blue sidebar-mini"> 
  <div class="wrapper"> 
   <header class="main-header"> 
    <!-- Logo --> 
    <a href="MobileHome.html" class="logo"> 
     <!-- mini logo for sidebar mini 50x50 pixels --> <span class="logo-mini"><b>A</b>LT</span> 
     <!-- logo for regular state and mobile devices --> <span class="logo-lg"><b>Mobile</b>Home</span> </a> 
    <!-- Header Navbar: style can be found in header.less --> 
    <nav class="navbar navbar-static-top"> 
     <!-- Sidebar toggle button--> 
     <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button"> <span class="sr-only">Toggle navigation</span> </a> 
    </nav> 
   </header> 
   <!-- Left side column. contains the logo and sidebar --> 
   <aside class="main-sidebar"> 
    <!-- sidebar: style can be found in sidebar.less --> 
    <section class="sidebar"> 
     <!-- /.search form --> 
     <!-- sidebar menu: : style can be found in sidebar.less --> 
     <ul class="sidebar-menu" data-widget="tree"> 
      <li class="header">MAIN NAVIGATION</li> 
      <li class="treeview"> <a href="#"> <i class="fa fa-dashboard"></i> <span>Mobile Dashboard</span> <span class="pull-right-container"> <i class="fa fa-angle-left pull-right"></i> </span> </a> 
       <ul class="treeview-menu"> 
        <li><a href="index.html"><i class="fa fa-circle-o"></i> Mobile Home</a> </li> 
        <li><a href="MobileHome_SFURL.html"><i class="fa fa-circle-o"></i> SF URL List</a></li> 
       </ul> </li> 
      <li class="active treeview"> <a href="#"> <i class="fa fa-dashboard"></i> <span>MP Dashboard</span> <span class="pull-right-container"> <i class="fa fa-angle-left pull-right"></i> </span> </a> 
       <ul class="treeview-menu"> 
        <li><a href="MobileHome_MPServiceMonitorByMonth.html"><i class="fa fa-circle-o"></i> MP Heartbeat Monitor by Month</a></li> 
        <li><a href="/mp-ut-report/index.html" target="_blank"><i class="fa fa-circle-o"></i> MP UT Status</a></li> 
        <li><a href="https://confluence.successfactors.com/pages/viewpage.action?pageId=253382020" target="_blank"><i class="fa fa-circle-o"></i> MP UT Coverage Chart</a></li> 
        <li class="active"><a href="MobileHome_MPAPIStatus.html"><i class="fa fa-circle-o"></i> MP API Status</a></li> 
        <li><a href="MobileHome_MPAutoJob.html"><i class="fa fa-circle-o"></i> MP Automation Job</a></li> 
       </ul> </li> 
      <li class="treeview"> <a href="#"> <i class="fa fa-dashboard"></i> <span>Client Dashboard</span> <span class="pull-right-container"> <i class="fa fa-angle-left pull-right"></i> </span> </a> 
       <ul class="treeview-menu"> 
        <li><a href="Page_Not_Ready.html"><i class="fa fa-circle-o"></i> (TBD) iOS Sanity Status</a></li> 
        <li><a href="Page_Not_Ready.html"><i class="fa fa-circle-o"></i> (TBD) Android SanityStatus</a></li> 
        <li><a href="Page_Not_Ready.html"><i class="fa fa-circle-o"></i> (TBD) Automation Job</a></li> 
       </ul> </li> 
      <li class="treeview"> <a href="#"> <i class="fa fa-dashboard"></i> <span>Regression Dashboard</span> <span class="pull-right-container"> <i class="fa fa-angle-left pull-right"></i> </span> </a> 
       <ul class="treeview-menu"> 
        <li><a href="Page_Not_Ready.html"><i class="fa fa-circle-o"></i> (TBD) Regression Home Status</a></li> 
        <li><a href="MobileHome_MPAPIStatus.html"><i class="fa fa-circle-o"></i> MP API Regression Status</a></li> 
        <li><a href="MobileHome_IOSRegressionStatus.html"><i class="fa fa-circle-o"></i> iOS Regression Status</a></li> 
        <li><a href="MobileHome_AndroidRegressionStatus.html"><i class="fa fa-circle-o"></i> Android Regression Status</a></li> 
        <li><a href="MobileHome_EndToEndPeformance.html"><i class="fa fa-circle-o"></i> Mobile E2E Peformance Status</a></li> 
        <li><a href="MobileHome_LMSMobileStatus.html"><i class="fa fa-circle-o"></i> Mobile LMS Mobile Status</a></li> 
        <li><a href="MobileHome_MPPDStatus.html"><i class="fa fa-circle-o"></i> MP Post Deployment Status</a></li> 
       </ul> </li> 
     </ul> 
    </section> 
    <!-- /.sidebar --> 
   </aside> 
   <!-- Content Wrapper. Contains page content --> 
   <div class="content-wrapper"> 
    <!-- Content Header (Page header) --> 
    <section class="content-header"> 
     <h1>MP API Status<small>Dashboard</small></h1> 
    </section> 
    <div class="row"> 
            <div class="margin"> 
                <div class="col-md-3"> 
                    <div class="form-group"> 
                        <label>Test data ENV</label> 
                        <select id="id_env" class="form-control"> <option>qapatchpreview</option> <option>qacand</option> </select> 
                    </div>
                    <div class="form-group"> 
                        <label>Choose a version</label> 
                        <select id="id_versions" class="form-control"> </select> 
                    </div>
                </div>
                <div class="col-md-3"> 
                    <div class="form-group"> 
                        <label>Compare data ENV</label> 
                        <select id="id_env2" class="form-control"> <option>qapatchpreview</option> <option>qacand</option> </select> 
                    </div> 
            
                    <div class="form-group"> 
                        <label>Compare a version</label> 
                        <select id="id_versions2" class="form-control"> </select> 
                    </div> 
                </div> 
                <div class="col-md-3"> 
                    <button type="button" class="btn btn-warning" onclick="loadData()">Start Compare</button>
                </div>
            </div>
            </div>
    
    <!-- Main content --> 
    <section class="content"> 
     <!-- Small boxes (Stat box) --> 
     <!-- /.row --> 
     <div class="row"> 
      <div class="col-md-12"> 
       <!-- Custom Tabs --> 
       <div class="nav-tabs-custom"> 
        <div class="tab-content"> 
         <div class="tab-pane active" id="tab_1"> 
          <!-- Main row --> 
          <div class="row"> 
           <div class="col-md-12"> 
            <div class="box"> 
             <div class="box-header"> 
              <h3 class="box-title">Overall</h3> 
             </div> 
             <!-- /.box-header --> 
             <div id="data_table_parent" class="box-body no-padding"> 
             </div> 
             <!-- /.box-body --> 
            </div> 
           </div> 
          </div> 
          <div class="row"> 
            <div class="col-md-6"> 
             <div class="box"> 
              <div class="box-header"> 
               <h3 class="box-title">Count by feature</h3> 
              </div> 
              <!-- /.box-header --> 
              <div id="data_table_count_parent" class="box-body no-padding"> 
              </div> 
              <!-- /.box-body --> 
             </div> 
            </div> 
            <div class="col-md-6"> 
                <div class="box"> 
                    <div class="box-header"> 
                      <h3 class="box-title">Passrate by feature</h3> 
                    </div> 
                     <!-- /.box-header --> 
                    <div id="data_table_passrate_parent" class="box-body no-padding"> 
                    </div> 
                     <!-- /.box-body --> 
                </div> 
            </div> 
           </div> 
          <!-- /.row (main row) --> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
    </section> 
    <!-- /.content --> 
   </div> 
   <aside class="control-sidebar control-sidebar-dark"> 
    <!-- Create the tabs --> 
    <ul class="nav nav-tabs nav-justified control-sidebar-tabs"> 
     <li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li> 
     <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li> 
    </ul> 
    <!-- Tab panes --> 
    <div class="tab-content"> 
     <!-- Home tab content --> 
     <div class="tab-pane" id="control-sidebar-home-tab"> 
      <h3 class="control-sidebar-heading">Recent Activity</h3> 
      <ul class="control-sidebar-menu"> 
       <li> <a href="javascript:void(0)"> <i class="menu-icon fa fa-birthday-cake bg-red"></i> 
         <div class="menu-info"> 
          <h4 class="control-sidebar-subheading">Langdon's Birthday</h4> 
          <p>Will be 23 on April 24th</p> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <i class="menu-icon fa fa-user bg-yellow"></i> 
         <div class="menu-info"> 
          <h4 class="control-sidebar-subheading">Frodo Updated His Profile </h4> 
          <p>New phone +1(800)555-1234</p> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <i class="menu-icon fa fa-envelope-o bg-light-blue"></i> 
         <div class="menu-info"> 
          <h4 class="control-sidebar-subheading">Nora Joined Mailing List </h4> 
          <p>nora@example.com</p> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <i class="menu-icon fa fa-file-code-o bg-green"></i> 
         <div class="menu-info"> 
          <h4 class="control-sidebar-subheading">Cron Job 254 Executed </h4> 
          <p>Execution time 5 seconds</p> 
         </div> </a> </li> 
      </ul> 
      <!-- /.control-sidebar-menu --> 
      <h3 class="control-sidebar-heading">Tasks Progress</h3> 
      <ul class="control-sidebar-menu"> 
       <li> <a href="javascript:void(0)"> <h4 class="control-sidebar-subheading"> Custom Template Design <span class="label label-danger pull-right">70%</span> </h4> 
         <div class="progress progress-xxs"> 
          <div class="progress-bar progress-bar-danger" style="width: 70%"></div> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <h4 class="control-sidebar-subheading"> Update Resume <span class="label label-success pull-right">95%</span> </h4> 
         <div class="progress progress-xxs"> 
          <div class="progress-bar progress-bar-success" style="width: 95%"></div> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <h4 class="control-sidebar-subheading"> Laravel Integration <span class="label label-warning pull-right">50%</span> </h4> 
         <div class="progress progress-xxs"> 
          <div class="progress-bar progress-bar-warning" style="width: 50%"></div> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <h4 class="control-sidebar-subheading"> Back End Framework <span class="label label-primary pull-right">68%</span> </h4> 
         <div class="progress progress-xxs"> 
          <div class="progress-bar progress-bar-primary" style="width: 68%"></div> 
         </div> </a> </li> 
      </ul> 
      <!-- /.control-sidebar-menu --> 
     </div> 
     <!-- /.tab-pane --> 
     <!-- Stats tab content --> 
     <div class="tab-pane" id="control-sidebar-stats-tab">
      Stats Tab Content 
     </div> 
     <!-- /.tab-pane --> 
     <!-- Settings tab content --> 
     <div class="tab-pane" id="control-sidebar-settings-tab"> 
      <form method="post"> 
       <h3 class="control-sidebar-heading">General Settings</h3> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Report panel usage <input type="checkbox" class="pull-right" checked="" /> </label> 
        <p>Some information about this general settings option</p> 
       </div> 
       <!-- /.form-group --> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Allow mail redirect <input type="checkbox" class="pull-right" checked="" /> </label> 
        <p>Other sets of options are available</p> 
       </div> 
       <!-- /.form-group --> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Expose author name in posts <input type="checkbox" class="pull-right" checked="" /> </label> 
        <p>Allow the user to show his name in blog posts</p> 
       </div> 
       <!-- /.form-group --> 
       <h3 class="control-sidebar-heading">Chat Settings</h3> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Show me as online <input type="checkbox" class="pull-right" checked="" /> </label> 
       </div> 
       <!-- /.form-group --> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Turn off notifications <input type="checkbox" class="pull-right" /> </label> 
       </div> 
       <!-- /.form-group --> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Delete chat history <a href="javascript:void(0)" class="text-red pull-right"><i class="fa fa-trash-o"></i></a> </label> 
       </div> 
       <!-- /.form-group --> 
      </form> 
     </div> 
     <!-- /.tab-pane --> 
    </div> 
   </aside> 
   <!-- /.control-sidebar --> 
   <!-- Add the sidebar's background. This div must be placed
            immediately after the control sidebar --> 
   <div class="control-sidebar-bg"></div> 
  </div> 
  <!-- ./wrapper --> 
  <!-- jQuery 3 --> 
  <script src="bower_components/jquery/dist/jquery.min.js"></script> 
  <!-- jQuery UI 1.11.4 --> 
  <script src="bower_components/jquery-ui/jquery-ui.min.js"></script> 
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip --> 
  <script>
        $.widget.bridge('uibutton', $.ui.button);
    </script> 
  <!-- Bootstrap 3.3.7 --> 
  <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script> 
  <!-- Morris.js charts --> 
  <script src="bower_components/raphael/raphael.min.js"></script> 
  <script src="bower_components/morris.js/morris.min.js"></script> 
  <!-- Sparkline --> 
  <script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script> 
  <!-- jvectormap --> 
  <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script> 
  <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script> 
  <!-- jQuery Knob Chart --> 
  <script src="bower_components/jquery-knob/dist/jquery.knob.min.js"></script> 
  <!-- daterangepicker --> 
  <script src="bower_components/moment/min/moment.min.js"></script> 
  <script src="bower_components/bootstrap-daterangepicker/daterangepicker.js"></script> 
  <!-- datepicker --> 
  <script src="bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script> 
  <!-- Bootstrap WYSIHTML5 --> 
  <script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script> 
  <!-- Slimscroll --> 
  <script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script> 
  <!-- FastClick --> 
  <script src="bower_components/fastclick/lib/fastclick.js"></script> 
  <!-- AdminLTE App --> 
  <script src="dist/js/adminlte.min.js"></script> 
  <!-- AdminLTE dashboard demo (This is only for demo purposes) --> 
  <script src="dist/js/pages/dashboard.js"></script> 
  <!-- AdminLTE for demo purposes --> 
  <script src="dist/js/demo.js"></script> 
  <!-- FLOT CHARTS --> 
  <script src="bower_components/Flot/jquery.flot.js"></script> 
  <!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized --> 
  <script src="bower_components/Flot/jquery.flot.resize.js"></script> 
  <!-- FLOT PIE PLUGIN - also used to draw donut charts --> 
  <script src="bower_components/Flot/jquery.flot.pie.js"></script> 
  <!-- FLOT CATEGORIES PLUGIN - Used to draw bar charts --> 
  <script src="bower_components/Flot/jquery.flot.categories.js"></script> 
  <!-- DataTables --> 
  <script src="bower_components/datatables.net/js/jquery.dataTables.min.js"></script> 
  <script src="bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script> 
  <!-- Page script --> 
  <script>
        var id_data_table_parent = "#data_table_parent";
        var data_table_content = "<table id=\"table_overal_details_data\" class=\"table table-condensed\"></table>";
        
        var id_data_table_count_parent = "#data_table_count_parent";
        var id_data_table_passrate_parent = "#data_table_passrate_parent";
        var data_table_count_content = "<table id=\"table_count_details_data\" class=\"table table-condensed\"></table>";
        var data_table_passrate_content = "<table id=\"table_passrate_details_data\" class=\"table table-condensed\"></table>";

        var data1 = "";
        var data2 = "";
        function loadData1(currentSelected1, testENV1, currentSelected2, testENV2, donutChatId, teamFMapId, ownerFMapId, failureChatId, dataJsonFile, featureNameFilter1) {
            $(id_data_table_parent).empty();
            $(id_data_table_parent).append(data_table_content)
            $(id_data_table_count_parent).empty();
            $(id_data_table_count_parent).append(data_table_count_content)
            $(id_data_table_passrate_parent).empty();
            $(id_data_table_passrate_parent).append(data_table_passrate_content)
            $(teamFMapId).empty();
            $(ownerFMapId).empty();
            $(failureChatId).empty();
            $.getJSON(dataJsonFile, function(json) {
                var data = json;
                var html = '';
                var totalpass1 = 0;
                var totalfail1 = 0;
                var totalskip1 = 0;
                var totalpass2 = 0;
                var totalfail2 = 0;
                var totalskip2 = 0;
                var count1 = 0;
                var count2 = 0;
                var teamFailMap = new Map();
                var ownerFailMap = new Map();
                var featureFailMap = new Map();
                var mpBranchInfoList = "";

                var overallSummaryJson1 = "{";
                var summaryJson1 = "[";
                var overallSummaryJson2 = "{";
                var summaryJson2 = "[";
                var countall = 0;

    
      
                data.forEach(function(file, i) {
                    
                    var newfilepath = file + ((testENV1 === ""|| testENV1 === "NA")?"":("-" + testENV1)) + ((currentSelected1 === "NA")?"":("-" + currentSelected1));
                    newfilepath = "/Sappium/" + newfilepath + "/" + newfilepath + "_latest";
                    
                    $.getJSON(newfilepath, function(fdata) {
                        var jobname = fdata.job_name;
                        var lens = jobname.length - featureNameFilter1.length - ((testENV1 === ""|| testENV1 === "NA")?0:(1 + testENV1.length)) - ((currentSelected1 === ""|| currentSelected1 === "NA")?0:(1 + currentSelected1.length));
                        var featureName = jobname.substr(featureNameFilter1.length, lens);
                        var passrate = fdata.pass_rate.substr(0, fdata.pass_rate.length - 1);
                        var team = fdata.team;
                        var owner = fdata.owner;
                        var comment = fdata.hasOwnProperty("comment") ? fdata.comment : "";
                        var executionAt = fdata.execution_start_time;
                        var executionDuration = fdata.execution_duration;
                        var saveCommentId = 'id_' + jobname + '_input';
                        var jobUniqueId = fdata.job_run_unique_id;
                        var branchInfo = (fdata.client_build_branch === "") ? "" : (fdata.client_build_branch + " " + fdata.client_build_version);
                        var jobLogLink = fdata.log_link;
                        var rerunJobLink = "";
                        var jobLink = "";
                        var jobRerunHtmlId = jobname+'_rerun_'+jobUniqueId;
                        var jobBuildHtmlId = jobname+'_build_new_';
                        if (jobLogLink !== "") {
                            if(jobLogLink.indexOf(",")) {
                                jobLogLink = jobLogLink.split(",")[0];
                            }
                            jobLink = jobLogLink.substr(0, jobLogLink.lastIndexOf("/"));
                            jobLink = jobLink.substr(0, jobLink.lastIndexOf("/"));
                            
                        }
                        summaryJson1 = summaryJson1 + "{"
                            + "\"team\":" + "\""+team+"\", "
                            + "\"feature\": " + "\""+featureName+"\", "
                            + "\"owner\":" + "\""+owner+"\", "
                            + "\"passrate\":" + "\""+passrate+"\", "
                            + "\"caselist\":" + "[";
                        var cases = fdata.testResults;
                        cases.forEach(function(caseDetails) {
                            var testLinkId = caseDetails.test_id;
                            var testResult = caseDetails.result;
                            var failReason = caseDetails.failed_at;
                            var owner = caseDetails.owner;
                            var executionDuration = caseDetails.execution_time;
                            var comment = caseDetails.analysis_comment;
                            var caseName = caseDetails.case_name;
                            var testClass = caseDetails.test_class;
                            var testModule = caseDetails.module;

                            summaryJson1 = summaryJson1 + "\""+testLinkId+"\",";
                        })
                        summaryJson1 = summaryJson1.substr(0, summaryJson1.length - 1) + "]},";
                        
                        // $(tableId).append(html);
                        count1 += 1;
                        totalpass1 += parseInt(fdata.pass_case_count);
                        totalfail1 += parseInt(fdata.fail_case_count);
                        totalskip1 += parseInt(fdata.skip_case_count);
                        
                        if (count1 === data.length) {
                            summaryJson1 = summaryJson1.substr(0, summaryJson1.length - 1) + "]";
                            overallSummaryJson1 = overallSummaryJson1 +
                                "\"version\":" + "\"" + currentSelected1 + "\"," +
                                "\"totalpassrate\":" + "\"" + ((totalpass1/(totalfail1+totalskip1+totalpass1))*100).toFixed(2) + "\", " + 
                                "\"totalcount\":" + "\"" + (totalfail1+totalskip1+totalpass1) + "\", " + 
                                "\"details\":" + summaryJson1 + 
                                "}";
                            data1 = overallSummaryJson1;
                            countall ++;
                            if (countall == 2) {
                                var m = data1;
                                var n = data2;
                                drawTable(data1, data2);
                            }
                        }

                    }).fail(function(jqXHR) {
                        if (jqXHR.status == 404) {
                            //alert("404 Not Found");
                            count1++;
                            if (count1 === data.length) {
                                summaryJson1 = summaryJson1.substr(0, summaryJson1.length - 1) + "]";
                                overallSummaryJson1 = overallSummaryJson1 +
                                "\"version\":" + "\"" + currentSelected1 + "\"," +
                                "\"totalpassrate\":" + "\"" + ((totalpass1/(totalfail1+totalskip1+totalpass1))*100).toFixed(2) + "\", " + 
                                "\"totalcount\":" + "\"" + (totalfail1+totalskip1+totalpass1) + "\", " + 
                                "\"details\":" + summaryJson1 + 
                                "}";
                                data1 = overallSummaryJson1;
                                countall ++;
                                if (countall == 2) {
                                    var m = data1;
                                var n = data2;
                                drawTable(data1, data2);
                                }
                                // saveComment(file, content, method)
                            }
                        }
                    });

                    
                    
                    var newfilepath2 = file + ((testENV2 === ""|| testENV2 === "NA")?"":("-" + testENV2)) + ((currentSelected2 === "NA")?"":("-" + currentSelected2));
                    newfilepath2 = "/Sappium/" + newfilepath2 + "/" + newfilepath2 + "_latest";
                    
                    $.getJSON(newfilepath2, function(fdata) {
                        var jobname = fdata.job_name;
                        var lens = jobname.length - featureNameFilter1.length - ((testENV2 === ""|| testENV2 === "NA")?0:(1 + testENV2.length)) - ((currentSelected2 === ""|| currentSelected2 === "NA")?0:(1 + currentSelected2.length));
                        var featureName = jobname.substr(featureNameFilter1.length, lens);
                        var passrate = fdata.pass_rate.substr(0, fdata.pass_rate.length - 1);
                        var team = fdata.team;
                        var owner = fdata.owner;
                        var comment = fdata.hasOwnProperty("comment") ? fdata.comment : "";
                        var executionAt = fdata.execution_start_time;
                        var executionDuration = fdata.execution_duration;
                        var saveCommentId = 'id_' + jobname + '_input';
                        var jobUniqueId = fdata.job_run_unique_id;
                        var branchInfo = (fdata.client_build_branch === "") ? "" : (fdata.client_build_branch + " " + fdata.client_build_version);
                        var jobLogLink = fdata.log_link;
                        var rerunJobLink = "";
                        var jobLink = "";
                        var jobRerunHtmlId = jobname+'_rerun_'+jobUniqueId;
                        var jobBuildHtmlId = jobname+'_build_new_';
                        if (jobLogLink !== "") {
                            if(jobLogLink.indexOf(",")) {
                                jobLogLink = jobLogLink.split(",")[0];
                            }
                            jobLink = jobLogLink.substr(0, jobLogLink.lastIndexOf("/"));
                            jobLink = jobLink.substr(0, jobLink.lastIndexOf("/"));
                            
                        }
                        summaryJson2 = summaryJson2 + "{"
                            + "\"team\":" + "\""+team+"\", "
                            + "\"feature\": " + "\""+featureName+"\", "
                            + "\"owner\":" + "\""+owner+"\", "
                            + "\"passrate\":" + "\""+passrate+"\", "
                            + "\"caselist\":" + "[";
                        var cases = fdata.testResults;
                        cases.forEach(function(caseDetails) {
                            var testLinkId = caseDetails.test_id;
                            var testResult = caseDetails.result;
                            var failReason = caseDetails.failed_at;
                            var owner = caseDetails.owner;
                            var executionDuration = caseDetails.execution_time;
                            var comment = caseDetails.analysis_comment;
                            var caseName = caseDetails.case_name;
                            var testClass = caseDetails.test_class;
                            var testModule = caseDetails.module;

                            summaryJson2 = summaryJson2 + "\""+testLinkId+"\",";
                        })
                        summaryJson2 = summaryJson2.substr(0, summaryJson2.length - 1) + "]},";
                        
                        // $(tableId).append(html);
                        count2 += 1;
                        totalpass2 += parseInt(fdata.pass_case_count);
                        totalfail2 += parseInt(fdata.fail_case_count);
                        totalskip2 += parseInt(fdata.skip_case_count);
                        
                        if (count2 === data.length) {
                            summaryJson2 = summaryJson2.substr(0, summaryJson2.length - 1) + "]";
                            overallSummaryJson2 = overallSummaryJson2 +
                                "\"version\":" + "\"" + currentSelected2 + "\"," +
                                "\"totalpassrate\":" + "\"" + ((totalpass2/(totalfail2+totalskip2+totalpass2))*100).toFixed(2) + "\", " + 
                                "\"totalcount\":" + "\"" + (totalfail2+totalskip2+totalpass2) + "\", " + 
                                "\"details\":" + summaryJson2 + 
                                "}";
                            data2 = overallSummaryJson2;
                            countall ++;
                            if (countall == 2) {
                                var m = data1;
                                var n = data2;
                                drawTable(data1, data2);

                            }
                        }

                    }).fail(function(jqXHR) {
                        if (jqXHR.status == 404) {
                            //alert("404 Not Found");
                            count2++;
                            if (count2 === data.length) {
                                summaryJson2 = summaryJson2.substr(0, summaryJson2.length - 1) + "]";
                                overallSummaryJson2 = overallSummaryJson2 +
                                "\"version\":" + "\"" + currentSelected2 + "\"," +
                                "\"totalpassrate\":" + "\"" + ((totalpass2/(totalfail2+totalskip2+totalpass2))*100).toFixed(2) + "\", " + 
                                "\"totalcount\":" + "\"" + (totalfail2+totalskip2+totalpass2) + "\", " + 
                                "\"details\":" + summaryJson2 + 
                                "}";
                                data2 = overallSummaryJson2;
                                countall ++;
                                if (countall == 2) {
                                    var m = data1;
                                var n = data2;
                                drawTable(data1, data2);
                                }
                                // saveComment(file, content, method)
                            }
                        }
                    });
                });

                
            });

        }
        
        function drawTable(data1, data2) {
            var jsonData;
            json1 = JSON.parse(data1);
            json2 = JSON.parse(data2);
            version1=json1.version;
            version2=json2.version;
            
            var table_header_html = '<thead><tr>\n' +
            '<th style="width: 60px">Overall</th>\n' +
            '<th style="width: 60px">'+version1+'</th>\n' +
            '<th style="width: 60px">'+version2+'</th>\n' +
            //'<th style="width: 30px">'+version1+'  -  '+version2+'</th>\n' +
            '<th style="width: 30px">Compare</th>\n' +
            '</tr></thead><tbody>';
            $(tableId).append(table_header_html);


            jsonData = "[" + 
                "{" +
                "\"summary\":" + "\"passrate\"," +
                "\"release1\":\""+ json1.totalpassrate +"\"," +
                "\"release2\":\""+ json2.totalpassrate +"\"," +
                "\"compare\":\""+ (json1.totalpassrate-json2.totalpassrate).toFixed(2) +"\"" +
                "}," +
                "{" +
                "\"summary\":" + "\"total count\"," +
                "\"release1\":\""+ json1.totalcount +"\"," +
                "\"release2\":\""+ json2.totalcount +"\"," +
                "\"compare\":\""+ (json1.totalcount-json2.totalcount) +"\"" +
                "}" +
                "]"
            json = JSON.parse(jsonData);
            $(tableId).dataTable({
                "data": json,
                "columns": [
                        { "data": "summary" },
                        { "data": "release1" },
                        { "data": "release2" },
                        { "data": "compare" }
                ]
            });
            
            // var featureList = new Array();
            var fianlResult = "[";
            let featurelist = new Array();

            json1.details.forEach(function(featureData, i) {
                var mapString = "{";

                var team = featureData.team;
                var feature = featureData.feature;
                var owner = featureData.owner;
                var passrate1 = featureData.passrate;
                var count1 = featureData.caselist.length;
                list1 = featureData.caselist;
                
                var passrate2 = "0";
                var count2 = 0;
                var list2 = list1;
                
                featurelist.push(feature);
                mapString = mapString + "\"feature\":\""+feature+"\","
                    + "\"team\":\""+team+"\","
                    + "\"owner\":\""+owner+"\","
                    + "\"passrate1\":\""+passrate1+"\","
                    + "\"count1\":\""+count1+"\",";

                json2.details.forEach(function(featureData2, j) {
                    if(featureData2.feature === feature) {
                        passrate2 = featureData2.passrate;
                        count2 = featureData2.caselist.length;
                        list2 = featureData2.caselist;
                        return false;
                    }
                }) 

                mapString = mapString + "\"passrate2\":\""+passrate2+"\","      
                    + "\"count2\":\""+count2+"\","      
                    + "\"countcompare\":\""+(count1-count2)+"\",";

                var newcount = 0;
                var deletecount = 0;        
                if(count2 !== 0) {
                    list1.forEach(function(case1,x) {
                        if(list2.indexOf(case1) < 0) {newcount ++;}
                    })
                    list2.forEach(function(case2,x) {
                        if(list1.indexOf(case2) < 0) {deletecount ++;}
                    })
                    
                }
                mapString = mapString + "\"passratecompare\":\""+(passrate1-passrate2).toFixed(2)+"\","      
                    + "\"newcases\":\""+newcount+"\","      
                    + "\"deletecases\":\""+deletecount+"\"}";

                fianlResult = fianlResult + mapString + ",";
            })
            
            json2.details.forEach(function(featureData, i) {
                var mapString = "{";
                var feature = featureData.feature;
                var hasIt = false;

                if(featurelist.indexOf(feature)>=0) {
                    hasIt=true;
                }
                if(!hasIt) {
                    var team = featureData.team;
                    var owner = featureData.owner;
                    var passrate2 = featureData.passrate;
                    var count2 = featureData.caselist.length;
                    var passrate1 = 0
                    var count1 = 0;
                    mapString = mapString + "\"feature\":\""+feature+"\","
                    + "\"team\":\""+team+"\","
                    + "\"owner\":\""+owner+"\","
                    + "\"passrate1\":\""+passrate1+"\","
                    + "\"count1\":\""+count1+"\","
                    + "\"passrate2\":\""+passrate2+"\","
                    + "\"count2\":\""+count2+"\","
                    + "\"countcompare\":\""+count2+"\","
                    + "\"passratecompare\":\"0\","
                    + "\"newcases\":\"0\","
                    + "\"deletecases\":\""+count2+"\"}"

                    fianlResult = fianlResult + mapString + ",";
                }
                
            })

            fianlResult = fianlResult.substr(0, fianlResult.length - 1) + "]";
            var jsonArray = JSON.parse(fianlResult);

            var table_header_html2 = '<thead><tr>\n' +
            '<th style="width: 60px">Team</th>\n' +
            '<th style="width: 60px">Feature</th>\n' +
            '<th style="width: 30px">'+version1+' %</th>\n' +
            '<th style="width: 30px">'+version2+' %</th>\n' +
            '<th style="width: 60px" bgcolor="yellow">Compare % </th>\n' +
            '<th style="width: 60px">Owner</th>\n' +
            '</tr></thead><tbody>';
            $(tableId2).append(table_header_html2);

            var table_header_html3 = '<thead><tr>\n' +
            '<th style="width: 60px">Team</th>\n' +
            '<th style="width: 60px">Feature</th>\n' +
            '<th style="width: 30px">'+version1+' #</th>\n' +
            '<th style="width: 30px">'+version2+' #</th>\n' +
            '<th style="width: 60px" bgcolor="yellow">Compare case count </th>\n' +
            '<th style="width: 30px"><font color="green">New cases </font></th>\n' +
            '<th style="width: 30px"><font color="red">Deleted cases </font></th>\n' +
            '<th style="width: 60px">Owner</th>\n' +
            '</tr></thead><tbody>';
            $(tableId3).append(table_header_html3);

            $(tableId2).dataTable({
                "data": jsonArray,
                "iDisplayLength": 50,
                "order": [[ 4, "asc" ]],
                "columns": [
                        { "data": "team" },
                        { "data": "feature" },
                        { "data": "passrate1" },
                        { "data": "passrate2" },
                        { "data": "passratecompare" },
                        { "data": "owner" }
                ]
            });
            $(tableId3).dataTable({
                "data": jsonArray,
                "iDisplayLength": 50,
                "order": [[ 4, "asc" ]],
                "columns": [
                        { "data": "team" },
                        { "data": "feature" },
                        { "data": "count1" },
                        { "data": "count2" },
                        { "data": "countcompare" },
                        { "data": "newcases" },
                        { "data": "deletecases" },
                        { "data": "owner" }
                ]
            });

        }

        function getVersions() {
            versionID = "#id_versions";
            $(versionID).empty();
            versionID2 = "#id_versions2";
            $(versionID2).empty();
            var html = "";
            var versionFilePath = "show_versions.json";
            $.getJSON(versionFilePath, function(json) {
                var versions = json;
                if(versions.hasOwnProperty("default")) {
                    html = html + '<option>'+ versions.default +'</option>';
                }
                if(versions.hasOwnProperty("mob")) {
                    var moblist = versions.mob;
                    moblist.forEach(function(caseDetails) {

                        html = html + '<option>'+ caseDetails +'</option>';
                    });
                }
                // if(versions.hasOwnProperty("bizx")) {
                //     var moblist = versions.bizx;
                //     moblist.forEach(function(caseDetails) {

                //         html = html + '<option>'+ caseDetails +'</option>';
                //     });
                // }
                if(versions.hasOwnProperty("other")) {
                    var moblist = versions.other;
                    moblist.forEach(function(caseDetails) {

                        html = html + '<option>'+ caseDetails +'</option>';
                    });

                }
                $(versionID).append(html);
                $(versionID2).append(html);
                loadData();
            });
        }
        function loadData() {
            var versionInfo = document.getElementById("id_versions");
            var versionInfo2 = document.getElementById("id_versions2");
            var currentSelected1 = versionInfo.options[versionInfo.selectedIndex].text;
            var currentSelected2 = versionInfo2.options[versionInfo2.selectedIndex].text;
            var envInfo = document.getElementById("id_env");
            var envInfo2 = document.getElementById("id_env2");
            var testENV = envInfo.options[envInfo.selectedIndex].text;
            var testENV2 = envInfo2.options[envInfo2.selectedIndex].text;

            tableId = "#table_overal_details_data";
            tableId2 = "#table_passrate_details_data";
            tableId3 = "#table_count_details_data";
            donutChatId = "#donut-chart-preview-overall";
            teamFMapId = "#donut-chart-preview-byteam";
            ownerFMapId = "#donut-chart-preview-byowner";
            failureChatId = "#donut-chart-preview-overall-failures";
            dataJsonFile = "MP_Daily_API_Job_conf.json";
            featureNameFilter1 = "MPAPI-Feature-Test-";
            loadData1(currentSelected1, testENV, currentSelected2, testENV, donutChatId, teamFMapId, ownerFMapId, failureChatId, dataJsonFile, featureNameFilter1);
            
        }

        $(document).ready(getVersions());
    </script>  
 </body>
</html>