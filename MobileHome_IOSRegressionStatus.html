<!DOCTYPE html>
<html>
 <head> 
  <meta charset="utf-8" /> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge" /> 
  <title>AdminLTE 2 | Dashboard</title> 
  <!-- Tell the browser to be responsive to screen width --> 
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" /> 
  <!-- Bootstrap 3.3.7 --> 
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" /> 
  <!-- Font Awesome --> 
  <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css" /> 
  <!-- Ionicons --> 
  <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css" /> 
  <!-- Theme style --> 
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css" /> 
  <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. --> 
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css" /> 
  <!-- Morris chart --> 
  <link rel="stylesheet" href="bower_components/morris.js/morris.css" /> 
  <!-- jvectormap --> 
  <link rel="stylesheet" href="bower_components/jvectormap/jquery-jvectormap.css" /> 
  <!-- Date Picker --> 
  <link rel="stylesheet" href="bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" /> 
  <!-- Daterange picker --> 
  <link rel="stylesheet" href="bower_components/bootstrap-daterangepicker/daterangepicker.css" /> 
  <!-- bootstrap wysihtml5 - text editor --> 
  <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" /> 
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries --> 
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// --> 
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]--> 
  <!-- Google Font --> 
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic" /> 
 </head> 
 <body class="hold-transition skin-blue sidebar-mini"> 
  <div class="wrapper"> 
   <header class="main-header"> 
    <!-- Logo --> 
    <a href="MobileHome.html" class="logo"> 
     <!-- mini logo for sidebar mini 50x50 pixels --> <span class="logo-mini"><b>A</b>LT</span> 
     <!-- logo for regular state and mobile devices --> <span class="logo-lg"><b>Mobile</b>Home</span> </a> 
    <!-- Header Navbar: style can be found in header.less --> 
    <nav class="navbar navbar-static-top"> 
     <!-- Sidebar toggle button--> 
     <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button"> <span class="sr-only">Toggle navigation</span> </a> 
    </nav> 
   </header> 
   <!-- Left side column. contains the logo and sidebar --> 
   <aside class="main-sidebar"> 
    <!-- sidebar: style can be found in sidebar.less --> 
    <section class="sidebar"> 
     <!-- /.search form --> 
     <!-- sidebar menu: : style can be found in sidebar.less --> 
     <ul class="sidebar-menu" data-widget="tree"> 
      <li class="header">MAIN NAVIGATION</li> 
      <li class="treeview"> <a href="#"> <i class="fa fa-dashboard"></i> <span>Mobile Dashboard</span> <span class="pull-right-container"> <i class="fa fa-angle-left pull-right"></i> </span> </a> 
       <ul class="treeview-menu"> 
        <li><a href="index.html"><i class="fa fa-circle-o"></i> Mobile Home</a> </li> 
        <li><a href="MobileHome_SFURL.html"><i class="fa fa-circle-o"></i> SF URL List</a></li> 
       </ul> </li> 
      <li class="treeview"> <a href="#"> <i class="fa fa-dashboard"></i> <span>MP Dashboard</span> <span class="pull-right-container"> <i class="fa fa-angle-left pull-right"></i> </span> </a> 
       <ul class="treeview-menu"> 
        <li><a href="MobileHome_MPServiceMonitorByMonth.html"><i class="fa fa-circle-o"></i> MP Heartbeat Monitor by Month</a></li> 
        <li><a href="/mp-ut-report/index.html" target="_blank"><i class="fa fa-circle-o"></i> MP UT Status</a></li> 
        <li><a href="https://confluence.successfactors.com/pages/viewpage.action?pageId=253382020" target="_blank"><i class="fa fa-circle-o"></i> MP UT Coverage Chart</a></li> 
        <li><a href="MobileHome_MPAPIStatus.html"><i class="fa fa-circle-o"></i> MP API Status</a></li> 
        <li><a href="MobileHome_MPAutoJob.html"><i class="fa fa-circle-o"></i> MP Automation Job</a></li> 
       </ul> </li> 
      <li class="treeview"> <a href="#"> <i class="fa fa-dashboard"></i> <span>Client Dashboard</span> <span class="pull-right-container"> <i class="fa fa-angle-left pull-right"></i> </span> </a> 
       <ul class="treeview-menu"> 
        <li><a href="Page_Not_Ready.html"><i class="fa fa-circle-o"></i> (TBD) iOS Sanity Status</a></li> 
        <li><a href="Page_Not_Ready.html"><i class="fa fa-circle-o"></i> (TBD) Android SanityStatus</a></li> 
        <li><a href="Page_Not_Ready.html"><i class="fa fa-circle-o"></i> (TBD) Automation Job</a></li> 
       </ul> </li> 
      <li class="active treeview"> <a href="#"> <i class="fa fa-dashboard"></i> <span>Regression Dashboard</span> <span class="pull-right-container"> <i class="fa fa-angle-left pull-right"></i> </span> </a> 
       <ul class="treeview-menu"> 
        <li><a href="Page_Not_Ready.html"><i class="fa fa-circle-o"></i> (TBD) Regression Home Status</a></li> 
        <li><a href="MobileHome_MPAPIStatus.html"><i class="fa fa-circle-o"></i> MP API Regression Status</a></li> 
        <li class="active"><a href="MobileHome_IOSRegressionStatus.html"><i class="fa fa-circle-o"></i> iOS Regression Status</a></li> 
        <li><a href="MobileHome_AndroidRegressionStatus.html"><i class="fa fa-circle-o"></i> Android Regression Status</a></li> 
        <li><a href="MobileHome_EndToEndPeformance.html"><i class="fa fa-circle-o"></i> Mobile E2E Peformance Status</a></li> 
        <li><a href="MobileHome_LMSMobileStatus.html"><i class="fa fa-circle-o"></i> Mobile LMS Mobile Status</a></li> 
        <li><a href="MobileHome_MPPDStatus.html"><i class="fa fa-circle-o"></i> MP Post Deployment Status</a></li> 
       </ul> </li> 
     </ul> 
    </section> 
    <!-- /.sidebar --> 
   </aside> 
   <!-- Content Wrapper. Contains page content --> 
   <div class="content-wrapper"> 
    <!-- Content Header (Page header) --> 
    <section class="content-header"> 
     <h1> IOS Regression Status <small>Dashboard</small> </h1> 
     <!--ol class="breadcrumb">
                  <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                  <li class="active">Dashboard</li>
                  </ol--> 
    </section> 
    <div class="margin"> 
     <!-- select --> 
     <div class="form-group"> 
      <label>Choose a release version</label> 
      <select id="id_versions" class="form-control" onchange="loadData()"> </select> 
     </div> 
    </div> 
    <!-- Main content --> 
    <section class="content"> 
     <!-- Small boxes (Stat box) --> 
     <!-- /.row --> 
     <div class="row"> 
      <div class="col-md-12"> 
       <!-- Custom Tabs --> 
       <div class="nav-tabs-custom"> 
        <!-- <ul class="nav nav-tabs">
                           <li class="active" onclick="loadData1()"><a href="#tab_1" data-toggle="tab">QAPATCHPREVIEW</a></li>
                           <li onclick="loadData2()"><a href="#tab_2" data-toggle="tab">QACAND</a></li>
                           </ul> --> 
        <div class="tab-content"> 
         <div class="tab-pane active" id="tab_1"> 
          <!-- Main row --> 
          <div class="row"> 
           <div class="col-xs-12"> 
            <!-- Donut chart --> 
            <div class="box box-primary"> 
             <div class="box-header with-border"> 
              <i class="fa fa-bar-chart-o"></i> 
              <h3 class="box-title">Overall Status</h3> 
             </div> 
             <div class="box-body"> 
              <div class="row"> 
               <div class="col-xs-6 col-md-6 text-center"> 
                <div id="donut-chart-preview-overall" style="height: 300px;"></div> 
                <div id="donut-chart-preview-overall-failures" class="small-box-footerl"></div> 
               </div> 
               <div class="col-xs-1 col-md-1 text-left"></div> 
               <div class="col-xs-2 col-md-2 text-left"> 
                <div class="box-header"> 
                 <h3 class="box-title">Failures by team</h3> 
                </div> 
                <div class="box-body no-padding"> 
                 <table id="donut-chart-preview-byteam" class="table table-condensed"> 
                  <tbody>
                   <tr> 
                    <th>Team</th> 
                    <th>Failure count</th> 
                   </tr> 
                  </tbody>
                 </table> 
                </div> 
               </div> 
               <div class="col-xs-1 col-md-1 text-left"></div> 
               <div class="col-xs-2 col-md-2 text-left"> 
                <div class="box-header"> 
                 <h3 class="box-title">Failures by owner</h3> 
                </div> 
                <div class="box-body no-padding"> 
                 <table id="donut-chart-preview-byowner" class="table table-condensed"> 
                  <tbody>
                   <tr> 
                    <th>Owner</th> 
                    <th>Failure count</th> 
                   </tr> 
                  </tbody>
                 </table> 
                </div> 
               </div> 
              </div> 
             </div> 
             <!-- /.box-body--> 
            </div> 
            <!-- /.box --> 
           </div> 
           <!-- /.box --> 
          </div> 
          <div class="row"> 
           <div class="col-md-12"> 
            <div class="box"> 
             <div class="box-header"> 
              <h3 class="box-title">Status by Feature</h3> 
             </div> 
             <!-- /.box-header --> 
             <div id="data_table_parent" class="box-body no-padding"> 
             </div> 
             <!-- /.box-body --> 
            </div> 
           </div> 
          </div> 
          <!-- /.row (main row) --> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
    </section> 
    <!-- /.content --> 
   </div> 
   <!-- /.content-wrapper --> 
   <!--footer class="main-footer">
            <div class="pull-right hidden-xs">
              <b>Version</b> 2.4.0
            </div>
            <strong>Copyright &copy; 2014-2016 <a href="https://adminlte.io">Almsaeed Studio</a>.</strong> All rights
            reserved.
            </footer--> 
   <!-- Control Sidebar --> 
   <aside class="control-sidebar control-sidebar-dark"> 
    <!-- Create the tabs --> 
    <ul class="nav nav-tabs nav-justified control-sidebar-tabs"> 
     <li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li> 
     <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li> 
    </ul> 
    <!-- Tab panes --> 
    <div class="tab-content"> 
     <!-- Home tab content --> 
     <div class="tab-pane" id="control-sidebar-home-tab"> 
      <h3 class="control-sidebar-heading">Recent Activity</h3> 
      <ul class="control-sidebar-menu"> 
       <li> <a href="javascript:void(0)"> <i class="menu-icon fa fa-birthday-cake bg-red"></i> 
         <div class="menu-info"> 
          <h4 class="control-sidebar-subheading">Langdon's Birthday</h4> 
          <p>Will be 23 on April 24th</p> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <i class="menu-icon fa fa-user bg-yellow"></i> 
         <div class="menu-info"> 
          <h4 class="control-sidebar-subheading">Frodo Updated His Profile </h4> 
          <p>New phone +1(800)555-1234</p> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <i class="menu-icon fa fa-envelope-o bg-light-blue"></i> 
         <div class="menu-info"> 
          <h4 class="control-sidebar-subheading">Nora Joined Mailing List </h4> 
          <p>nora@example.com</p> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <i class="menu-icon fa fa-file-code-o bg-green"></i> 
         <div class="menu-info"> 
          <h4 class="control-sidebar-subheading">Cron Job 254 Executed </h4> 
          <p>Execution time 5 seconds</p> 
         </div> </a> </li> 
      </ul> 
      <!-- /.control-sidebar-menu --> 
      <h3 class="control-sidebar-heading">Tasks Progress</h3> 
      <ul class="control-sidebar-menu"> 
       <li> <a href="javascript:void(0)"> <h4 class="control-sidebar-subheading"> Custom Template Design <span class="label label-danger pull-right">70%</span> </h4> 
         <div class="progress progress-xxs"> 
          <div class="progress-bar progress-bar-danger" style="width: 70%"></div> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <h4 class="control-sidebar-subheading"> Update Resume <span class="label label-success pull-right">95%</span> </h4> 
         <div class="progress progress-xxs"> 
          <div class="progress-bar progress-bar-success" style="width: 95%"></div> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <h4 class="control-sidebar-subheading"> Laravel Integration <span class="label label-warning pull-right">50%</span> </h4> 
         <div class="progress progress-xxs"> 
          <div class="progress-bar progress-bar-warning" style="width: 50%"></div> 
         </div> </a> </li> 
       <li> <a href="javascript:void(0)"> <h4 class="control-sidebar-subheading"> Back End Framework <span class="label label-primary pull-right">68%</span> </h4> 
         <div class="progress progress-xxs"> 
          <div class="progress-bar progress-bar-primary" style="width: 68%"></div> 
         </div> </a> </li> 
      </ul> 
      <!-- /.control-sidebar-menu --> 
     </div> 
     <!-- /.tab-pane --> 
     <!-- Stats tab content --> 
     <div class="tab-pane" id="control-sidebar-stats-tab">
      Stats Tab Content 
     </div> 
     <!-- /.tab-pane --> 
     <!-- Settings tab content --> 
     <div class="tab-pane" id="control-sidebar-settings-tab"> 
      <form method="post"> 
       <h3 class="control-sidebar-heading">General Settings</h3> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Report panel usage <input type="checkbox" class="pull-right" checked="" /> </label> 
        <p>Some information about this general settings option</p> 
       </div> 
       <!-- /.form-group --> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Allow mail redirect <input type="checkbox" class="pull-right" checked="" /> </label> 
        <p>Other sets of options are available</p> 
       </div> 
       <!-- /.form-group --> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Expose author name in posts <input type="checkbox" class="pull-right" checked="" /> </label> 
        <p>Allow the user to show his name in blog posts</p> 
       </div> 
       <!-- /.form-group --> 
       <h3 class="control-sidebar-heading">Chat Settings</h3> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Show me as online <input type="checkbox" class="pull-right" checked="" /> </label> 
       </div> 
       <!-- /.form-group --> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Turn off notifications <input type="checkbox" class="pull-right" /> </label> 
       </div> 
       <!-- /.form-group --> 
       <div class="form-group"> 
        <label class="control-sidebar-subheading"> Delete chat history <a href="javascript:void(0)" class="text-red pull-right"><i class="fa fa-trash-o"></i></a> </label> 
       </div> 
       <!-- /.form-group --> 
      </form> 
     </div> 
     <!-- /.tab-pane --> 
    </div> 
   </aside> 
   <!-- /.control-sidebar --> 
   <!-- Add the sidebar's background. This div must be placed
            immediately after the control sidebar --> 
   <div class="control-sidebar-bg"></div> 
  </div> 
  <!-- ./wrapper --> 
  <!-- jQuery 3 --> 
  <script src="bower_components/jquery/dist/jquery.min.js"></script> 
  <!-- jQuery UI 1.11.4 --> 
  <script src="bower_components/jquery-ui/jquery-ui.min.js"></script> 
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip --> 
  <script>
        $.widget.bridge('uibutton', $.ui.button);
    </script> 
  <!-- Bootstrap 3.3.7 --> 
  <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script> 
  <!-- Morris.js charts --> 
  <script src="bower_components/raphael/raphael.min.js"></script> 
  <script src="bower_components/morris.js/morris.min.js"></script> 
  <!-- Sparkline --> 
  <script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script> 
  <!-- jvectormap --> 
  <script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script> 
  <script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script> 
  <!-- jQuery Knob Chart --> 
  <script src="bower_components/jquery-knob/dist/jquery.knob.min.js"></script> 
  <!-- daterangepicker --> 
  <script src="bower_components/moment/min/moment.min.js"></script> 
  <script src="bower_components/bootstrap-daterangepicker/daterangepicker.js"></script> 
  <!-- datepicker --> 
  <script src="bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script> 
  <!-- Bootstrap WYSIHTML5 --> 
  <script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script> 
  <!-- Slimscroll --> 
  <script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script> 
  <!-- FastClick --> 
  <script src="bower_components/fastclick/lib/fastclick.js"></script> 
  <!-- AdminLTE App --> 
  <script src="dist/js/adminlte.min.js"></script> 
  <!-- AdminLTE dashboard demo (This is only for demo purposes) --> 
  <script src="dist/js/pages/dashboard.js"></script> 
  <!-- AdminLTE for demo purposes --> 
  <script src="dist/js/demo.js"></script> 
  <!-- FLOT CHARTS --> 
  <script src="bower_components/Flot/jquery.flot.js"></script> 
  <!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized --> 
  <script src="bower_components/Flot/jquery.flot.resize.js"></script> 
  <!-- FLOT PIE PLUGIN - also used to draw donut charts --> 
  <script src="bower_components/Flot/jquery.flot.pie.js"></script> 
  <!-- FLOT CATEGORIES PLUGIN - Used to draw bar charts --> 
  <script src="bower_components/Flot/jquery.flot.categories.js"></script> 
  <!-- DataTables --> 
  <script src="bower_components/datatables.net/js/jquery.dataTables.min.js"></script> 
  <script src="bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script> 
  <!-- Page script --> 
  <script>
        var id_data_table_parent = "#data_table_parent";
        var data_table_content = "<table id=\"table_preview\" class=\"table table-condensed\"></table>"
        var table_header_html = '<thead><tr>\n' +
            '<th style="width: 60px">Team</th>\n' +
            '<th style="width: 60px">Feature</th>\n' +
            '<th style="width: 100px">Pass Rate</th>\n' +
            '<th style="width: 30px"></th>\n' +
            '<th style="width: 30px">Fail/Total</th>\n' +
            '<th style="width: 30px">ExecutionAt</th>\n' +
            '<th style="width: 30px">ExecutionDuration</th>\n' +
            '<th style="width: 30px">Owner</th>\n' +
            '<th style="width: 30px">Comment</th>\n' +
            '<th style="width: 30px"></th>\n' +
            '<th style="width: 30px">Details Report</th>\n' +
            '<th style="width: 60px">Job Info / Log / Run</th>\n' +
            '</tr></thead><tbody>'

        function loadData1(currentSelected,donutChatId, teamFMapId, ownerFMapId, failureChatId, dataJsonFile, featureNameFilter1, featureNameFilter2, testENV) {
            $(id_data_table_parent).empty();
            $(id_data_table_parent).append(data_table_content)
            $(teamFMapId).empty();
            $(ownerFMapId).empty();
            $(failureChatId).empty();
            $(tableId).append(table_header_html);
            $.getJSON(dataJsonFile, function(json) {
                var data = json;
                var html = '';
                var totalpass = 0;
                var totalfail = 0;
                var totalskip = 0;
                var count = 0;
                var teamFailMap = new Map();
                var ownerFailMap = new Map();
                var featureFailMap = new Map();
                var mpBranchInfoList = "";
                data.forEach(function(file, i) {

                    var newfilepath = file + ((testENV === ""|| testENV === "NA")?"":("-" + testENV)) + ((currentSelected === "NA")?"":("-" + currentSelected));
                    newfilepath = "/Sappium/" + newfilepath + "/" + newfilepath + "_latest";

                    $.getJSON(newfilepath, function(fdata) {
                        var jobname = fdata.job_name;
                        var lens = jobname.length - featureNameFilter1.length - featureNameFilter2.length - ((currentSelected === ""|| currentSelected === "NA")?0:(1 + currentSelected.length));
                        var featureName = jobname.substr(featureNameFilter1.length, lens);
                        var passrate = fdata.pass_rate.substr(0, fdata.pass_rate.length - 1);
                        var team = fdata.team;
                        var owner = fdata.owner;
                        var comment = fdata.hasOwnProperty("comment") ? fdata.comment : "";
                        var executionAt = fdata.execution_start_time;
                        var executionDuration = fdata.execution_duration;
                        var saveCommentId = 'id_' + jobname + '_input';
                        var jobUniqueId = fdata.job_run_unique_id;
                        var branchInfo = (fdata.client_build_branch === "") ? "" : (fdata.client_build_branch + " " + fdata.client_build_version);
                        var jobLogLink = fdata.log_link;
                        var rerunJobLink = "";
                        var jobLink = "";
                        var jobRerunHtmlId = jobname+'_rerun_'+jobUniqueId;
                        var jobBuildHtmlId = jobname+'_build_new_';
                        if (jobLogLink !== "") {
                            if(jobLogLink.indexOf(",")) {
                                jobLogLink = jobLogLink.split(",")[0];
                            }
                            jobLink = jobLogLink.substr(0, jobLogLink.lastIndexOf("/"));
                            jobLink = jobLink.substr(0, jobLink.lastIndexOf("/"));
                            
                        }
                        html = '<tr>' +
                            '<td>' + team + '</td>' +
                            '<td>' + featureName + '</td>' +
                            '<td><div class="progress progress-xs"><div class="progress-bar progress-bar-success" style="width: ' + passrate + '%"></div></div></td>' +
                            '<td><span class="badge bg-' + (passrate == 100 ? "green" : (passrate > 90 ? "yellow" : "red")) + '">' + passrate + '%</td>' +
                            '<td>' + (parseInt(fdata.fail_case_count) + parseInt(fdata.skip_case_count)) + '/' + (parseInt(fdata.fail_case_count) + parseInt(fdata.skip_case_count) + parseInt(fdata.pass_case_count)) + '</td>' +
                            '<td>' + executionAt + '</td>' +
                            '<td>' + executionDuration + '</td>' +
                            '<td>' + owner + '</td>' +
                            '<td><input id="' + saveCommentId + '" type="text" value="' + comment + '" class="form-control"></td>' +
                            '<td><input id="' + (saveCommentId + '_button') + '" type="button" value="save" onclick="saveComment(\'' + newfilepath + '\',\'' + saveCommentId + '\',\'' + jobUniqueId + '\',\'comment\')"></td>' +
                            '<td><button type="button" class="btn btn-default btn-xs"><a href="MobileHome_TestDetails.html?detailpath=' + newfilepath + '" class="small-box-footer" target="_blank">Details</a></button></td>' +
                            (jobLink == "" ? '<td></td>' : ('<td><div class="btn-group">'+
                            '<button type="button" class="btn btn-default btn-xs"><a href="' + jobLink + '" class="small-box-footer" target="_blank">View Job</a></button>'+
                            '<button type="button" class="btn btn-default btn-xs"><a href="' + jobLogLink + '" class="small-box-footer" target="_blank">View Log</a></button>' +
                                (passrate == 100 ? ('<input class="btn btn-info btn-xs" value="Launch a new test" onclick="openBuildForm(\''+jobLink+'\',\''+currentSelected+'\',\''+jobBuildHtmlId+'\')"><span id="'+jobBuildHtmlId+'" type="button"></span></input>') :
                                ('<input class="btn btn-warning btn-xs" value="Rerun failures" onclick="openRerunForm(\''+jobLink+'\',\''+currentSelected+'\',\''+jobUniqueId+'\',\''+jobRerunHtmlId+'\')"><span id="'+jobRerunHtmlId+'" type="button"></span></input>')) +
                            '</div></td>'))+
                            // (rerunJobLink == "" ? '<td></td>' : (passrate == 100 ? ('<td><a href="' + jobLink + '" title="View Job - build #' + jobUniqueId + '" class="small-box-footer" target="_blank">View Job</a></td>') : ('<td><a href="' + rerunJobLink + '" title="Click to redirect to Jenkins build job page.\t\n[Server] - Select correct env info(qacand/qapatchpreview)\n[RunType] - Select reRun\n[reRunForId] - Input the build number: ' + jobUniqueId + '\n[MailTo] - Input correct email address\nClick Build button to launch the job" class="small-box-footer" target="_blank">Rerun for build# ' + jobUniqueId + '</a></td>'))) +
                            '</tr>';
                            // '<td><a href="MobileHome_TestDetails.html?detailpath=' + newfilepath + '" class="small-box-footer" target="_blank"><i class="fa fa-arrow-circle-right"></i></a></td>' +
                            // (rerunJobLink == "" ? '<td></td>' : (passrate == 100 ? ('<td><a href="' + jobLink + '" title="View Job - build #' + jobUniqueId + '" class="small-box-footer" target="_blank">View Job</a></td>') : ('<td><a href="' + rerunJobLink + '" title="Click to redirect to Jenkins build job page.\t\n[Server] - Select correct env info(qacand/qapatchpreview)\n[RunType] - Select reRun\n[reRunForId] - Input the build number: ' + jobUniqueId + '\n[MailTo] - Input correct email address\nClick Build button to launch the job" class="small-box-footer" target="_blank">Rerun for build# ' + jobUniqueId + '</a></td>'))) +
                            // '</tr>';

                        $(tableId).append(html);
                        count += 1;
                        totalpass += parseInt(fdata.pass_case_count);
                        totalfail += parseInt(fdata.fail_case_count);
                        totalskip += parseInt(fdata.skip_case_count);
                        //for team failures map
                        var teamFcount = 0;
                        if (teamFailMap.has(team)) {
                            teamFcount = teamFailMap.get(team);
                        }
                        if (parseInt(fdata.fail_case_count) + parseInt(fdata.skip_case_count) > 0) {
                            teamFcount = teamFcount + parseInt(fdata.fail_case_count) + parseInt(fdata.skip_case_count);
                            teamFailMap.set(team, teamFcount);
                        }
                        //for owner failures map
                        var ownerFcount = 0;
                        if (ownerFailMap.has(owner)) {
                            ownerFcount = ownerFailMap.get(owner);
                        }
                        if (parseInt(fdata.fail_case_count) + parseInt(fdata.skip_case_count) > 0) {
                            ownerFcount = ownerFcount + parseInt(fdata.fail_case_count) + parseInt(fdata.skip_case_count);
                            ownerFailMap.set(owner, ownerFcount);
                            featureFailMap.set(featureName, parseInt(fdata.fail_case_count) + parseInt(fdata.skip_case_count));
                        }
                        //branch info
                        if (branchInfo != null && branchInfo !== "" && !mpBranchInfoList.includes(branchInfo)) {
                            mpBranchInfoList = (mpBranchInfoList === "") ? branchInfo : (mpBranchInfoList + "," + branchInfo);
                        }
                        if (count === data.length) {
                            $(tableId).append("</tbody>");
                            $(tableId).DataTable();
                            /*
                             * DONUT CHART - overall
                             * -----------
                             */
                            addOverallData(totalpass, totalfail, totalskip, donutChatId, teamFailMap, ownerFailMap, teamFMapId, ownerFMapId, featureFailMap, mpBranchInfoList, failureChatId);

                        }

                    }).fail(function(jqXHR) {
                        if (jqXHR.status == 404) {
                            //alert("404 Not Found");
                            count++;
                            if (count === data.length) {
                                $(tableId).append("</tbody>");
                                $(tableId).DataTable();
                                /*
                                 * DONUT CHART - overall
                                 * -----------
                                 */
                                addOverallData(totalpass, totalfail, totalskip, donutChatId, teamFailMap, ownerFailMap, teamFMapId, ownerFMapId, featureFailMap, mpBranchInfoList, failureChatId);

                            }
                        }
                    });

                });

            });

        }

        function addOverallData(totalpass, totalfail, totalskip, donutChatId, teamFailMap, ownerFailMap, teamFMapId, ownerFMapId, featureFailMap, mpBranchInfoList, failureChatId) {
            var donutData = [{
                    label: 'Pass',
                    data: totalpass,
                    color: '#00a65a'
                }, {
                    label: 'Fail',
                    data: (totalfail + totalskip),
                    color: '#f56954'
                }
                // { label: 'skip', data: totalskip, color: '#f39c12' }
            ]
            $.plot(donutChatId, donutData, {
                    series: {
                        pie: {
                            show: true,
                            radius: 1,
                            innerRadius: 0.5,
                            label: {
                                show: true,
                                radius: 2 / 3,
                                formatter: labelFormatter,
                                threshold: 0.1
                            }

                        }
                    },
                    legend: {
                        show: true
                    }
                })
                /*
                 * END DONUT CHART
                 */

            /**
             * Failure by Team
             */
            teamFailMap.forEach(function(value, key, teamFailMap) {
                html = '<tr>' +
                    '<td>' + key + '</td>' +
                    '<td>' + value + '</td>' +
                    '</tr>';

                $(teamFMapId).append(html);
            });

            /**
             * Failure by Owner
             */
            ownerFailMap.forEach(function(value, key, ownerFailMap) {
                html = '<tr>' +
                    '<td>' + key + '</td>' +
                    '<td>' + value + '</td>' +
                    '</tr>';

                $(ownerFMapId).append(html);
            });

            /*
             * Custom Label formatter
             * ----------------------
             */
            function labelFormatter(label, series) {
                return '<div style="font-size:13px; text-align:center; padding:2px; color: #fff; font-weight: 600;">' + label + '<br>'
                    // + Math.round(series.percent) + '%</div>'
                    + series.percent.toFixed(2) + '%</div>'
            }
            /*
             * get failures by feature
             */
            var featureFailure = "<div><b>Failures</b>: ";
            featureFailMap.forEach(function(value, key, featureFailMap) {
                featureFailure = featureFailure.indexOf(")") > 0 ? featureFailure + "," + key + "(" + value + ")" : featureFailure + key + "(" + value + ")";

            });
            featureFailure = featureFailure + "</div>";
            var mpBranchInfoString = featureFailure + "<div><b>Branch_Commit</b>: " + mpBranchInfoList + "</div>";
            $(failureChatId).append(mpBranchInfoString);
        }

        function getVersions() {
            versionID = "#id_versions";
            $(versionID).empty();
            var html = "";
            var versionFilePath = "show_versions.json";
            $.getJSON(versionFilePath, function(json) {
                var versions = json;
                if(versions.hasOwnProperty("default")) {
                    html = html + '<option>'+ versions.default +'</option>';
                }
                if(versions.hasOwnProperty("mob")) {
                    var moblist = versions.mob;
                    moblist.forEach(function(caseDetails) {

                        html = html + '<option>'+ caseDetails +'</option>';
                    });
                }
                // if(versions.hasOwnProperty("bizx")) {
                //     var moblist = versions.bizx;
                //     moblist.forEach(function(caseDetails) {

                //         html = html + '<option>'+ caseDetails +'</option>';
                //     });
                // }
                if(versions.hasOwnProperty("other")) {
                    var moblist = versions.other;
                    moblist.forEach(function(caseDetails) {

                        html = html + '<option>'+ caseDetails +'</option>';
                    });

                }
                $(versionID).append(html);
                loadData();
            });
            
        }

        function loadData() {
            var versionInfo = document.getElementById("id_versions");
            var currentSelected = versionInfo.options[versionInfo.selectedIndex].text;
            tableId = "#table_preview";
            donutChatId = "#donut-chart-preview-overall";
            teamFMapId = "#donut-chart-preview-byteam";
            ownerFMapId = "#donut-chart-preview-byowner";
            failureChatId = "#donut-chart-preview-overall-failures";
            dataJsonFile = "IOS_Regression_Job_conf.json";
            var testENV = "";
            featureNameFilter1 = "IOS-";
            featureNameFilter2 = "-Test";
            loadData1(currentSelected,donutChatId, teamFMapId, ownerFMapId, failureChatId, dataJsonFile, featureNameFilter1, featureNameFilter2, testENV);

        }

        /**
        * Run / Rerun Jenkins job Form popup
        */
        function openBuildForm(jobLink, testENV, jobHtmlId) {
            var versionInfo = document.getElementById("id_versions");
            var currentSelected = versionInfo.options[versionInfo.selectedIndex].text;

            var url = jobLink.replace('http://','http://mobileauto:19429e842657b2a7b5fdbc5645984247@');
            url = url + "/buildWithParameters";
            $("#"+jobHtmlId).empty()
            //<div class="col-md-3">
            var formHtml='<div class="box"><div class="box box-success"><div class="box-header with-border"><h3 class="box-title">Launch a new test</h3>';
            var buttonGroup='<div class="box-tools pull-right"><button type="button" class="btn btn-box-tool" onclick="closeFormPopup(\''+jobHtmlId+'\')"><i class="fa fa-times"></i></button></div> </div>';
             var forBody2='<form target="_blank" action="'+url+'" method="post">'+
                '<div class="form-group"><input type="hidden" name="token" id="token" value="$APIAutoRemoteTriggerKey"></div>'+
                '<div class="form-group"><label class="control-sidebar-subheading" for="Node">Node &nbsp;<input class="pull-right" name="Node" id="Node" value="Slave-11A"></label></div>'+
                '<br><div class="form-group"><label class="control-sidebar-subheading" for="Server">Server &nbsp;<input class="pull-right" name="Server" id="Server" value="qapatchpreview"></label></div>'+
                // '<div class="form-group"><label class="control-sidebar-subheading" for="Node">Node<input id="Node" list="node_value"><datalist id="node_value"><option value="Slave-11A">Slave-11A</option><option value="Slave-11A">Slave-11A</option></datalist></label></div>'+
                // '<div class="form-group"><label class="control-sidebar-subheading" for="Server">Server<input id="Server" list="server_value"><datalist id="server_value"><option value="qapatchpreview">qapatchpreview</option><option value="qacand">qacand</option><option value="docker">docker</option></datalist></label></div>'+
                '<div class="form-group"><input type="hidden" class="pull-right" name="RunType" id="RunType" value="newRun"></div>'+
                '<br><div class="form-group"><label class="control-sidebar-subheading" for="RerunCycle">RerunCycle &nbsp;<input class="pull-right" name="RerunCycle" id="RerunCycle" value="0"></label></div>'+
                '<br><div class="form-group"><label class="control-sidebar-subheading" for="MailTo">MailTo &nbsp;<input class="pull-right" name="MailTo" id="MailTo" value=""></label></div>'+
                '<br><div class="form-group"><label class="control-sidebar-subheading" for="TestFor">TestFor &nbsp;<input class="pull-right" name="TestFor" id="TestFor" value="'+currentSelected+'"></label></div>'+
                '<br><input type="submit" value="click To Run"></form>';
            
            var formBody='<div class="box-body">'+forBody2;
            var afterFormBody='<div><a href="' + jobLink + '" title="view the job, or check if job launched" class="small-box-footer" target="_blank">View Job(check if job launched, etc)</a></div>'
            var formHtml=formHtml+buttonGroup+formBody+afterFormBody+'</div></div></div>';
                
            $("#"+jobHtmlId).append(formHtml);
        }

        function openRerunForm(jobLink, testENV, jobRerunId,jobHtmlId) {
            var versionInfo = document.getElementById("id_versions");
            var currentSelected = versionInfo.options[versionInfo.selectedIndex].text;

            var url = jobLink.replace('http://','http://mobileauto:19429e842657b2a7b5fdbc5645984247@');
            url = url + "/buildWithParameters";
            $("#"+jobHtmlId).empty()
            //<div class="col-md-3">
            var formHtml='<div class="box"><div class="box box-success"><div class="box-header with-border"><h3 class="box-title">Rerun failures in #'+jobRerunId+'</h3>';
            var buttonGroup='<div class="box-tools pull-right"><button type="button" class="btn btn-box-tool" onclick="closeFormPopup(\''+jobHtmlId+'\')"><i class="fa fa-times"></i></button></div> </div>';
            var forBody2='<form target="_blank" action="'+url+'" method="post">'+
                '<div class="form-group"><input type="hidden" name="token" id="token" value="$APIAutoRemoteTriggerKey"></div>'+
                '<div class="form-group"><label class="control-sidebar-subheading" for="Node">Node &nbsp;<input class="pull-right" name="Node" id="Node" value="Slave-11A"></label></div>'+
                '<br><div class="form-group"><label class="control-sidebar-subheading" for="Server">Server &nbsp;<input class="pull-right" name="Server" id="Server" value="qapatchpreview"></label></div>'+
                // '<div class="form-group"><label class="control-sidebar-subheading" for="Node">Node<input list="Node"><datalist id="Node"><option value="Slave-11A">Slave-11A</option><option value="Slave-11A">Slave-11A</option></datalist></label></div>'+
                // '<div class="form-group"><label class="control-sidebar-subheading" for="Server">Server<input list="Server"><datalist id="Server"><option value="qapatchpreview">qapatchpreview</option><option value="qacand">qacand</option><option value="docker">docker</option></datalist></label></div>'+
                '<br><div class="form-group"><label class="control-sidebar-subheading" for="RunType">RunType &nbsp; reRun<input type="hidden" class="pull-right" name="RunType" id="RunType" value="reRun" readonly="true"></label></div>'+
                '<br><div class="form-group"><label class="control-sidebar-subheading" for="reRunForId">reRunForId &nbsp; '+jobRerunId+'<input type="hidden" class="pull-right" name="reRunForId" id="reRunForId" value="'+jobRerunId+'" readonly="true"></label></div>' + 
		        '<br><div class="form-group"><label class="control-sidebar-subheading" for="RerunCycle">RerunCycle &nbsp;<input class="pull-right" name="RerunCycle" id="RerunCycle" value="1"></label></div>'+
                '<br><div class="form-group"><label class="control-sidebar-subheading" for="MailTo">MailTo &nbsp;<input class="pull-right" name="MailTo" id="MailTo" value=""></label></div>'+
                '<br><div class="form-group"><label class="control-sidebar-subheading" for="TestFor">TestFor &nbsp;<input class="pull-right" name="TestFor" id="TestFor" value="'+currentSelected+'"></label></div>'+
                '<br><input type="submit" value="click To Rerun"></form>';

            var formBody='<div class="box-body">'+forBody2;
            var afterFormBody='<div><a href="' + jobLink + '" title="view the job, or check if job launched" class="small-box-footer" target="_blank">View Job(check if job launched, etc)</a></div>'
            var formHtml=formHtml+buttonGroup+formBody+afterFormBody+'</div></div></div>';
                
            $("#"+jobHtmlId).append(formHtml);
        }
        function closeFormPopup(jobHtmlId) {
            $("#"+jobHtmlId).empty()
        }

        //save comment to Json - not done
        function saveComment(file, id, jobId, commentOrDetails) {
            var content = $("#" + id).val();
            var testId = "";
            if (commentOrDetails === 'details') {
                testId = id.replace("id_", "");
                testId = testId.replace("_input", "");
            }

            content = (content.length > 0) ? content : "null";
            content = encodeURIComponent(content);

            var host = window.location.host;

            if (commentOrDetails === 'comment') {
                queryString = "comment=" + content;

            } else if (commentOrDetails === 'details') {
                queryString = "updateTestDetails=" + content + "&" + "testId=" + testId;
            }

            // alert("host is: "+host);
            theUrl = "http://" + host + file + "?" + queryString;
            // alert("Will call "+theUrl);
            // alert("Will update [comment: "+content+"] to "+file);
            callHttpRequest(theUrl);

            if (file.includes("_latest")) {
                //////also update orginal file
                file = file.replace("_latest", ("_" + jobId));
                theUrl = "http://" + host + file + "?" + queryString;
                // alert("Will call " + theUrl);
                // alert("Will update [comment: "+content+"] to "+file);
                callHttpRequest(theUrl);
            }

        }

        function callHttpRequest(theUrl) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", theUrl, false); // false for synchronous request
            // alert(" "+theUrl);
            xmlHttp.send(null);
            window.location.reload(true);
        }
        $(document).ready(getVersions());
    </script>  
 </body>
</html>